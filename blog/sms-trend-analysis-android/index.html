<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="PwqxyVtbmKeb1wsrF8XJ5GQIPxlDxUupYnTEWPI3KLk" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <link href="/theme/img/fav.png" rel="icon" type="image/x-icon" />
    <meta property="og:site_name" content="Aravinda VK"/>
    <link rel="apple-touch-icon" href="/theme/img/fav.png" />
    <title>SMS trend analysis - Android</title>
    <meta property="og:title" content="SMS trend analysis - Android"/>
    <meta property="twitter:title" content="SMS trend analysis - Android"/>
    <meta name="description" content="Now a days my incoming and outgoing SMS trend looks like this for some reason :)"/>
    <meta property="og:description" content="Now a days my incoming and outgoing SMS trend looks like this for some reason :)"/>
    <meta property="twitter:description" content="Now a days my incoming and outgoing SMS trend looks like this for some reason :)"/>
    <meta property="og:url" content="https://aravindavk.in/blog/sms-trend-analysis-android/" />
    <meta property="twitter:url" content="https://aravindavk.in/blog/sms-trend-analysis-android/" />
    <meta property="og:image" content="https://aravindavk.in" />
    <link href="https://aravindavk.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aravinda VK Atom Feed" />
    <link rel="stylesheet" href="/theme/css/pure-min.css" />
    <link rel="stylesheet" href="/theme/css/side-menu.css" />
    <link rel="stylesheet" href="/theme/css/main.css?v=1" />
    <link rel="stylesheet" href="/theme/css/pygment-emacs-highlight.css" />
<script src="https://cdn.usefathom.com/script.js" data-site="GMVCMYMA" defer></script>
  </head>
  <body>
    <div id="layout">
      <!-- Menu toggle -->
      <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
      </a>
      <div id="menu" class="pure-hidden-desktop pure-hidden-tablet">
        <div class="pure-menu pure-menu-open">
          <a class="pure-menu-heading logo" href="/"><img src="/theme/img/logo.png" alt="aravindavk"/></a>
          <div class="social-icons">
            <a href="https://aravindavk.in/feeds/all.atom.xml" target="_blank" title="News">
              <img src="/theme/img/feed.png" class="link-icon" alt="News"/>
            </a>
            <a href="http://twitter.com/aravindavk" target="_blank" title="Twitter">
              <img src="/theme/img/twitter.png" class="link-icon" alt="Twitter"/>
            </a>
            <a href="https://plus.google.com/+aravindavk" target="_blank" title="Google Plus">
              <img src="/theme/img/gplus.png" class="link-icon" alt="Google Plus"/>
            </a>
            <a href="https://github.com/aravindavk" target="_blank" title="Github">
              <img src="/theme/img/github.png" class="link-icon" alt="Github"/>
            </a>
            <a href="http://www.flickr.com/photos/aravindavk" target="_blank" title="Flickr">
              <img src="/theme/img/flickr.png" class="link-icon" alt="Flickr"/>
            </a>
            <a href="http://in.linkedin.com/in/aravindavk" target="_blank" title="LinkedIn">
              <img src="/theme/img/linkedin.png" class="link-icon" alt="LinkedIn"/>
            </a>
          </div>
          <ul>
            <li class=""><a href="/">Home</a></li>
            <li class=""><a href="/me">About</a></li>
            <li class=""><a href="/projects">Projects</a></li>
            <li class=""><a href="/blogs">Blogs</a></li>
            <li class=""><a href="/talks">Talks & Articles</a></li>
          </ul>
        </div>
        <div class="sep"></div>
        <div class="copyright">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
      </div>

      <div class="pure-g-r">
        <div class="pure-u-4-5 content-left">
          <div class="left article">
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        SMS trend analysis - Android</h1>
    </header>
    <div class="pure-hidden-phone pure-hidden-tablet">
<footer class="post-info">
  <p class="author-and-date-info">
    Posted on Tue 09 April 2013 by <a class="url fn" href="https://aravindavk.in">Aravinda VK</a>.
  </p>
</footer><!-- /.post-info -->
<div class="sep"></div>    </div>
    <div class="entry-content">
      <p>Now a days my incoming and outgoing SMS trend looks like this for some(known) reason :)</p>
<div class="figure">
<img alt="Incoming sms trend" src="/images/incoming_sms_trend.png" />
<p class="caption">Incoming SMS trend(Nov 2012 - Apr 2013)</p>
</div>
<div class="figure">
<img alt="Outgoing sms trend" src="/images/outgoing_sms_trend.png" />
<p class="caption">Outgoing SMS trend(Nov 2012 - Apr 2013)</p>
</div>
<p><strong>PS</strong>: Sometimes I delete telemarketing SMS as and when I receive, so incoming trend may not show actual :) Also while playing with Android OS I lost all the SMS prior to Nov 2012.</p>
<p>***</p>
<p>Continue reading if you are wondering how I extracted the SMS data from the phone.</p>
<div class="section" id="prerequisites">
<h2>prerequisites:</h2>
<ol class="arabic simple" start="0">
<li>Android phone</li>
<li>Your Android phone should be rooted one.</li>
<li>Android SDK should be installed.</li>
<li>Debugging should be enabled in your android phone.</li>
</ol>
</div>
<div class="section" id="idea">
<h2>Idea:</h2>
<p>In Android, SMS data is stored in sqlite database, and it is located in the following directory(in phone).</p>
<div class="highlight"><pre><span></span>/data/data/com.android.providers.telephony/databases/mmssms.db
</pre></div>
<p>So we can run sql queries to get the details from sms table as per our need. To access the data from db, Android phone should be rooted.</p>
<p>Add <code>adb</code> path(in my machine adb path is <code>/home/aravinda/android-sdk/platform-tools/</code>) to environment variable PATH, and run <code>adb</code> as root.</p>
<div class="highlight"><pre><span></span>adb root
</pre></div>
<p>In sqlite we can see the list of tables present in a database using <code>.tables</code> (<code>sqlite3 &lt;db path&gt; &quot;.tables&quot;</code>) query.</p>
<div class="highlight"><pre><span></span>adb shell <span class="s1">&#39;sqlite3 /data/data/com.android.providers.telephony/databases/mmssms.db &quot;.tables&quot;&#39;</span>
</pre></div>
<p>and we can get schema of the required sqlite table using <code>.schema &lt;table name&gt;</code> query.</p>
<div class="highlight"><pre><span></span>adb shell <span class="s1">&#39;sqlite3 /data/data/com.android.providers.telephony/databases/mmssms.db &quot;.schema sms&quot;&#39;</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sms</span>
<span class="p">(</span>
    <span class="n">_id</span>                <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">thread_id</span>          <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">address</span>            <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">person</span>             <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="nb">date</span>               <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">date_sent</span>          <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">protocol</span>           <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">read</span>               <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">status</span>             <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="k">type</span>               <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">reply_path_present</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">subject</span>            <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">body</span>               <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">service_center</span>     <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">locked</span>             <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">error_code</span>         <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">seen</span>               <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span>
<span class="p">);</span>
</pre></div>
<p>Now we know how to run queries inside phone using <cite>adb</cite>, let us list down some of the ideas which we can implement using available sms data.</p>
<ol class="arabic simple">
<li>Number of SMS sent/received per day, to see the trend or if you have number of SMS limit per day/month.</li>
<li>SMS sent/received trend per hour, to see what time of the day I spend more in sending/receiving SMS.</li>
<li>Number of SMS per day per number, to see the trend per number.</li>
<li>Identify the messages/number to which I never interacted.</li>
<li>Identify the trend of teledirect numbers(Regex for non number phone number).</li>
<li>Backup all SMS database.</li>
<li>SMS book/conversations book.</li>
<li>Check how many sent messages are just less than 10 chars.</li>
<li>Live SMS notification in Laptop/Computer.</li>
</ol>
<p><strong>The only limitation is your imagination :D</strong></p>
<p><strong>Example</strong>: Number of sms sent per day.</p>
<p>Query is</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">STRFTIME</span><span class="p">(</span><span class="ss">&quot;%Y%m%d&quot;</span><span class="p">,</span> <span class="n">DATETIME</span><span class="p">(</span><span class="nb">date</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="ss">&quot;unixepoch&quot;</span><span class="p">,</span> <span class="ss">&quot;localtime&quot;</span><span class="p">))</span> <span class="n">dte</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">sms</span>
<span class="k">WHERE</span> <span class="k">type</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dte</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dte</span>
</pre></div>
<p>where type 2 is sent and 1 is received.</p>
<div class="highlight"><pre><span></span>adb shell <span class="s1">&#39;sqlite3 /data/data/com.android.providers.telephony/databases/mmssms.db \</span>
<span class="s1">&quot;SELECT STRFTIME(\&quot;%Y%m%d\&quot;, DATETIME(date/1000, \&quot;unixepoch\&quot;, \&quot;localtime\&quot;)) dte,  \</span>
<span class="s1">COUNT(_id) FROM sms WHERE type = 2 GROUP BY dte ORDER BY dte&quot;&#39;</span>
</pre></div>
<p>If you want to find number of sms sent per day for a particular phone number then add the condition in WHERE clause as follows</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">STRFTIME</span><span class="p">(</span><span class="ss">&quot;%Y%m%d&quot;</span><span class="p">,</span> <span class="n">DATETIME</span><span class="p">(</span><span class="nb">date</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="ss">&quot;unixepoch&quot;</span><span class="p">,</span> <span class="ss">&quot;localtime&quot;</span><span class="p">))</span> <span class="n">dte</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">sms</span>
<span class="k">WHERE</span> <span class="k">type</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dte</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dte</span>
<span class="k">AND</span> <span class="k">REPLACE</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="ss">&quot;+91&quot;</span><span class="p">,</span><span class="ss">&quot;&quot;</span><span class="p">),</span> <span class="ss">&quot; &quot;</span><span class="p">,</span> <span class="ss">&quot;&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="ss">&quot;XXXXX&quot;</span>
</pre></div>
<p>I created <a class="reference external" href="https://gist.github.com/aravindavk/5339192">Python script</a> to extract data as described above. Additionally script generates csv output which can be used to plot as required. Use any familiar library(Matplotlib, PhantomJS and d3, flot etc..) or just use Spreadsheet to plot the graph as required. I used Libreoffice Calc to create these charts.</p>
<p>Let me know if you find this blog useful and need any help in writing SQL queries :)</p>
</div>

    </div><!-- /.entry-content -->
    <div class="pure-hidden-desktop">
<footer class="post-info">
  <p class="author-and-date-info">
    Posted on Tue 09 April 2013 by <a class="url fn" href="https://aravindavk.in">Aravinda VK</a>.
  </p>
</footer><!-- /.post-info -->
<div class="sep"></div>    </div>
    <div class="permalink-div">
      Permalink: <a href="https://aravindavk.in/blog/sms-trend-analysis-android/" rel="bookmark" title="Permalink to SMS trend analysis - Android">https://aravindavk.in/blog/sms-trend-analysis-android/</a>
    </div>
<div class="comments">
  <h2>Comments !</h2>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_identifier = "blog/sms-trend-analysis-android/";
    var disqus_url = "https://aravindavk.in/blog/sms-trend-analysis-android/";
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://vkaravinda.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
</div>
  </article>
</section>
            <div class="copyright pure-hidden-desktop pure-hidden-tablet">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
          </div>
        </div>
        <div class="pure-u-1-5 pure-hidden-phone">
          <div class="right">
            <img class="me" src="/theme/img/me.jpg"/>
            <div class="sep"></div>
            <div class="pure-menu pure-menu-open">
              <a class="pure-menu-heading logo" href="/"><img src="/theme/img/logo.png" alt="aravindavk"/></a>
              <div class="social-icons">
                <a href="https://aravindavk.in/feeds/all.atom.xml" target="_blank" title="News">
                  <img src="/theme/img/feed.png" class="link-icon" alt="News"/>
                </a>
                <a href="http://twitter.com/aravindavk" target="_blank" title="Twitter">
                  <img src="/theme/img/twitter.png" class="link-icon" alt="Twitter"/>
                </a>
                <a href="https://plus.google.com/+aravindavk" target="_blank" title="Google Plus">
                  <img src="/theme/img/gplus.png" class="link-icon" alt="Google Plus"/>
                </a>
                <a href="https://github.com/aravindavk" target="_blank" title="Github">
                  <img src="/theme/img/github.png" class="link-icon" alt="Github"/>
                </a>
                <a href="http://www.flickr.com/photos/aravindavk" target="_blank" title="Flickr">
                  <img src="/theme/img/flickr.png" class="link-icon" alt="Flickr"/>
                </a>
                <a href="http://in.linkedin.com/in/aravindavk" target="_blank" title="LinkedIn">
                  <img src="/theme/img/linkedin.png" class="link-icon" alt="LinkedIn"/>
                </a>
              </div>
              <ul>
                <li class=""><a href="/">Home</a></li>
                <li class=""><a href="/me">About</a></li>
                <li class=""><a href="/projects">Projects</a></li>
                <li class=""><a href="/blogs">Blogs</a></li>
                <li class=""><a href="/talks">Talks & Articles</a></li>
              </ul>
            </div>
            <div class="sep"></div>
            <div class="copyright">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
          </div>
        </div>
      </div>

    </div>
    <script src="/theme/js/ui.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11830111-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>