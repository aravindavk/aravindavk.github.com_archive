<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="PwqxyVtbmKeb1wsrF8XJ5GQIPxlDxUupYnTEWPI3KLk" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <link href="/theme/img/fav.png" rel="icon" type="image/x-icon" />
    <meta property="og:site_name" content="Aravinda VK"/>
    <link rel="apple-touch-icon" href="/theme/img/fav.png" />
    <title>Developing Pebble Timeline Application - Webmon</title>
    <meta property="og:title" content="Developing Pebble Timeline Application - Webmon"/>
    <meta property="twitter:title" content="Developing Pebble Timeline Application - Webmon"/>
    <meta name="description" content="I created a Pebble Timeline application to monitor the status of websites called Webmon"/>
    <meta property="og:description" content="I created a Pebble Timeline application to monitor the status of websites called Webmon"/>
    <meta property="twitter:description" content="I created a Pebble Timeline application to monitor the status of websites called Webmon"/>
    <meta property="og:url" content="https://aravindavk.in/blog/developing-pebble-timeline-app-webmon/" />
    <meta property="twitter:url" content="https://aravindavk.in/blog/developing-pebble-timeline-app-webmon/" />
    <meta property="og:image" content="https://aravindavk.in" />
    <link href="https://aravindavk.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aravinda VK Atom Feed" />
    <link rel="stylesheet" href="/theme/css/pure-min.css" />
    <link rel="stylesheet" href="/theme/css/side-menu.css" />
    <link rel="stylesheet" href="/theme/css/main.css?v=1" />
    <link rel="stylesheet" href="/theme/css/pygment-emacs-highlight.css" />

  </head>
  <body>
    <div id="layout">
      <!-- Menu toggle -->
      <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
      </a>
      <div id="menu" class="pure-hidden-desktop pure-hidden-tablet">
        <div class="pure-menu pure-menu-open">
          <a class="pure-menu-heading logo" href="/"><img src="/theme/img/logo.png" alt="aravindavk"/></a>
          <div class="social-icons">
            <a href="https://aravindavk.in/feeds/all.atom.xml" target="_blank" title="News">
              <img src="/theme/img/feed.png" class="link-icon" alt="News"/>
            </a>
            <a href="http://twitter.com/aravindavk" target="_blank" title="Twitter">
              <img src="/theme/img/twitter.png" class="link-icon" alt="Twitter"/>
            </a>
            <a href="https://plus.google.com/+aravindavk" target="_blank" title="Google Plus">
              <img src="/theme/img/gplus.png" class="link-icon" alt="Google Plus"/>
            </a>
            <a href="https://github.com/aravindavk" target="_blank" title="Github">
              <img src="/theme/img/github.png" class="link-icon" alt="Github"/>
            </a>
            <a href="http://www.flickr.com/photos/aravindavk" target="_blank" title="Flickr">
              <img src="/theme/img/flickr.png" class="link-icon" alt="Flickr"/>
            </a>
            <a href="http://in.linkedin.com/in/aravindavk" target="_blank" title="LinkedIn">
              <img src="/theme/img/linkedin.png" class="link-icon" alt="LinkedIn"/>
            </a>
          </div>
          <ul>
            <li class=""><a href="/">Home</a></li>
            <li class=""><a href="/me">About</a></li>
            <li class=""><a href="/projects">Projects</a></li>
            <li class=""><a href="/blogs">Blogs</a></li>
            <li class=""><a href="/talks">Talks & Articles</a></li>
          </ul>
        </div>
        <div class="sep"></div>
        <div class="copyright">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
      </div>

      <div class="pure-g-r">
        <div class="pure-u-4-5 content-left">
          <div class="left article">
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        Developing Pebble Timeline Application - Webmon</h1>
    </header>
    <div class="pure-hidden-phone pure-hidden-tablet">
<footer class="post-info">
  <p class="author-and-date-info">
    Posted on Tue 02 June 2015 by <a class="url fn" href="https://aravindavk.in">Aravinda VK</a>.
  </p>
</footer><!-- /.post-info -->
<div class="sep"></div>    </div>
    <div class="entry-content">
      <p>Pebble firmware 3.0 introduced a new feature called <a class="reference external" href="https://developer.getpebble.com/guides/timeline/">Timeline</a>, the advantage of Timeline app is that processing happens in App server instead of in the Mobile / Watch, and can directly send notification to Watch (via the Timeline API website and phone, but no additional app required on the phone).</p>
<p>I created a Pebble Timeline application to monitor the status of websites called <a class="reference external" href="https://apps.getpebble.com/en_US/application/554627a6ab49e41f8f00004b">Webmon</a>. Sometimes friends/users will ping or email to inform that our website is not accessible for some reason. We may lose our business if we don't monitor them regularly.</p>
<img alt="Webmon App Logo" src="/images/webmon_logo.png" />
<p>I submitted this app as part of <a class="reference external" href="https://developer.getpebble.com/blog/2015/04/14/the-timeline-challenge-is-live/">#timelinechallenge</a>, but the app was not fully working that time and had issues with sending user Pins. I am not sure Pebble team looked at this app or not. :) And now most of the issues got resolved.</p>
<p>There are other possibilities similar to this app, for example</p>
<ol class="arabic simple">
<li>User can register a stock with min and max values, A cron can run every 5-15 mins in the app server. If stock price crosses the user configured limit, then send Timeline notification to user.</li>
<li>User can configure his/her blood group and location, A daemon in app server can run listening to various APIs like <a class="reference external" href="https://twitter.com/tweet4blood">&#64;tweet4blood</a>, if any matching request, send notification to Pebble user with blood request. The user can respond Yes/No(Anytime user can unsubscribe to the service)</li>
</ol>
<p>This application is written using Python (with Postgresql database) and hosted on <a class="reference external" href="https://www.openshift.com/">Red Hat OpenShift</a> cloud platform. (Free account as of now). Number of tracking URLs per user is limited as of now, but based on the feedbacks/usage I will enhance it to track multiple websites.</p>
<p>When I published the app link on <a class="reference external" href="http://www.reddit.com/r/pebble/comments/34sb31/webmon_website_health_monitor_timeline_app/">reddit</a>, <a class="reference external" href="http://www.reddit.com/user/spangborn">spangborn</a> was very concerned about the security issues and chances of app server getting blocked by domain owners. He raised some valid concerns, I am planning to address some of those comments soon.</p>
<p>Timeline APIs are good, <strong>but I feel insecure when it is allowed to push the User pins without using APP_KEY</strong>. If a user_token is exposed then anybody can send timeline messages and spam that user.</p>
<p>Pebble watch app &quot;webmon&quot; is simple, just displays a banner page to guide the user to configure the app in app config.</p>
<div class="figure">
<img alt="Screenshot of Watchapp" src="/images/webmon_watchapp.png" />
</div>
<p>In configure window, enter the website URL you want to track and click SAVE. You can anytime disable/enable the website tracking. When configuration is set, it sends registration request to the app server to register a website for tracking using PebbleKit JS.</p>
<div class="figure">
<img alt="Configuration page" src="/images/webmon_config.png" />
</div>
<p>A cron job runs on app server every one hour, gets the unique list of websites and does an HTTP GET request. If any website's state is different from previous state, then it prepares a Timeline notification and sends it. The app will not spam by sending too many messages, it only notifies the user if the state changed after previous run.</p>
<img alt="Healthy Notification" src="/images/webmon_healthy.png" />
<img alt="Faulty Notification" src="/images/webmon_faulty.png" />
<p>Sending user pin is super easy with Python, I used Python library <a class="reference external" href="https://pypi.python.org/pypi/requests">requests</a></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">pin</span> <span class="o">=</span> <span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="c1"># Valid Pin object</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://timeline-api.getpebble.com/v1/user/pins/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pin</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X-User-Token&quot;</span><span class="p">:</span> <span class="n">user_token</span><span class="p">,</span>
                             <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
<span class="nb">print</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span>
</pre></div>
<div class="section" id="technologies-used">
<h2>Technologies used:</h2>
<ol class="arabic simple">
<li>Pebblekit JS, Pebble SDK 3</li>
<li>Python (flask, requests, sqlalchemy)</li>
<li>Postgresql database</li>
<li>Cron</li>
</ol>
</div>
<div class="section" id="problems-faced">
<h2>Problems faced:</h2>
<p>Without having actual device, testing app is very very difficult to test the Timeline apps. I developed app using installed SDK, but for testing Timeline I copied all code to <a class="reference external" href="https://cloudpebble.net/">cloudpebble.net</a></p>
</div>
<div class="section" id="show-me-the-code">
<h2>Show me the Code:</h2>
<p>I love Open Source and sharing code makes me happy. Code is available in <a class="reference external" href="https://github.com/aravindavk/webmon">github.com/aravindavk/webmon</a> with MIT license.</p>
<p>***</p>
<p>Comments and Sugesstions welcome.</p>
</div>

    </div><!-- /.entry-content -->
    <div class="pure-hidden-desktop">
<footer class="post-info">
  <p class="author-and-date-info">
    Posted on Tue 02 June 2015 by <a class="url fn" href="https://aravindavk.in">Aravinda VK</a>.
  </p>
</footer><!-- /.post-info -->
<div class="sep"></div>    </div>
    <div class="permalink-div">
      Permalink: <a href="https://aravindavk.in/blog/developing-pebble-timeline-app-webmon/" rel="bookmark" title="Permalink to Developing Pebble Timeline Application - Webmon">https://aravindavk.in/blog/developing-pebble-timeline-app-webmon/</a>
    </div>
<div class="comments">
  <h2>Comments !</h2>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_identifier = "blog/developing-pebble-timeline-app-webmon/";
    var disqus_url = "https://aravindavk.in/blog/developing-pebble-timeline-app-webmon/";
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://vkaravinda.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
</div>
  </article>
</section>
            <div class="copyright pure-hidden-desktop pure-hidden-tablet">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
          </div>
        </div>
        <div class="pure-u-1-5 pure-hidden-phone">
          <div class="right">
            <img class="me" src="/theme/img/me.jpg"/>
            <div class="sep"></div>
            <div class="pure-menu pure-menu-open">
              <a class="pure-menu-heading logo" href="/"><img src="/theme/img/logo.png" alt="aravindavk"/></a>
              <div class="social-icons">
                <a href="https://aravindavk.in/feeds/all.atom.xml" target="_blank" title="News">
                  <img src="/theme/img/feed.png" class="link-icon" alt="News"/>
                </a>
                <a href="http://twitter.com/aravindavk" target="_blank" title="Twitter">
                  <img src="/theme/img/twitter.png" class="link-icon" alt="Twitter"/>
                </a>
                <a href="https://plus.google.com/+aravindavk" target="_blank" title="Google Plus">
                  <img src="/theme/img/gplus.png" class="link-icon" alt="Google Plus"/>
                </a>
                <a href="https://github.com/aravindavk" target="_blank" title="Github">
                  <img src="/theme/img/github.png" class="link-icon" alt="Github"/>
                </a>
                <a href="http://www.flickr.com/photos/aravindavk" target="_blank" title="Flickr">
                  <img src="/theme/img/flickr.png" class="link-icon" alt="Flickr"/>
                </a>
                <a href="http://in.linkedin.com/in/aravindavk" target="_blank" title="LinkedIn">
                  <img src="/theme/img/linkedin.png" class="link-icon" alt="LinkedIn"/>
                </a>
              </div>
              <ul>
                <li class=""><a href="/">Home</a></li>
                <li class=""><a href="/me">About</a></li>
                <li class=""><a href="/projects">Projects</a></li>
                <li class=""><a href="/blogs">Blogs</a></li>
                <li class=""><a href="/talks">Talks & Articles</a></li>
              </ul>
            </div>
            <div class="sep"></div>
            <div class="copyright">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
          </div>
        </div>
      </div>

    </div>
    <script src="/theme/js/ui.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11830111-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>