<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="PwqxyVtbmKeb1wsrF8XJ5GQIPxlDxUupYnTEWPI3KLk" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <link href="/theme/img/fav.png" rel="icon" type="image/x-icon" />
    <meta property="og:site_name" content="Aravinda VK"/>
    <link rel="apple-touch-icon" href="/theme/img/fav.png" />
    <title>Using Markdown and SHJS with PHP</title>
    <meta property="og:title" content="Using Markdown and SHJS with PHP"/>
    <meta property="twitter:title" content="Using Markdown and SHJS with PHP"/>
    <meta name="description" content="Markdown is a wiki like syntax standard, to have highly readable content."/>
    <meta property="og:description" content="Markdown is a wiki like syntax standard, to have highly readable content."/>
    <meta property="twitter:description" content="Markdown is a wiki like syntax standard, to have highly readable content."/>
    <meta property="og:url" content="http://aravindavk.in/blog/using-markdown-and-shjs-with-php/" />
    <meta property="twitter:url" content="http://aravindavk.in/blog/using-markdown-and-shjs-with-php/" />
    <meta property="og:image" content="http://aravindavk.in" />
    <link href="http://aravindavk.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aravinda VK Atom Feed" />
    <link rel="stylesheet" href="/theme/css/pure-min.css" />
    <link rel="stylesheet" href="/theme/css/side-menu.css" />
    <link rel="stylesheet" href="/theme/css/main.css" />
    <link rel="stylesheet" href="/theme/css/pygment-emacs-highlight.css" />
  </head>
  <body>
    <div id="layout">
      <!-- Menu toggle -->
      <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
      </a>
      <div id="menu" class="pure-hidden-desktop pure-hidden-tablet">
        <div class="pure-menu pure-menu-open">
          <a class="pure-menu-heading logo" href="/"><img src="/theme/img/logo.png" alt="aravindavk"/></a>
          <div class="social-icons">
            <a href="http://aravindavk.in/feeds/all.atom.xml" target="_blank" title="News">
              <img src="/theme/img/feed.png" class="link-icon" alt="News"/>
            </a>
            <a href="http://twitter.com/aravindavk" target="_blank" title="Twitter">
              <img src="/theme/img/twitter.png" class="link-icon" alt="Twitter"/>
            </a>
            <a href="https://plus.google.com/+aravindavk" target="_blank" title="Google Plus">
              <img src="/theme/img/gplus.png" class="link-icon" alt="Google Plus"/>
            </a>
            <a href="https://github.com/aravindavk" target="_blank" title="Github">
              <img src="/theme/img/github.png" class="link-icon" alt="Github"/>
            </a>
            <a href="http://www.flickr.com/photos/aravindavk" target="_blank" title="Flickr">
              <img src="/theme/img/flickr.png" class="link-icon" alt="Flickr"/>
            </a>
            <a href="http://in.linkedin.com/in/aravindavk" target="_blank" title="LinkedIn">
              <img src="/theme/img/linkedin.png" class="link-icon" alt="LinkedIn"/>
            </a>
          </div>
          <ul>
            <li class=""><a href="/">Home</a></li>
            <li class=""><a href="/me">About</a></li>
            <li class=""><a href="/projects">Projects</a></li>
            <li class=""><a href="/blogs">Blogs</a></li>
            <li class=""><a href="/talks">Talks & Articles</a></li>
          </ul>
        </div>
        <div class="sep"></div>
        <div class="copyright">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
      </div>

      <div class="pure-g-r">
        <div class="pure-u-4-5 content-left">
          <div class="left article">
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        Using Markdown and SHJS with PHP</h1>
    </header>
    <div class="pure-hidden-phone pure-hidden-tablet">
<footer class="post-info">
  <p class="author-and-date-info">
    Posted on Mon 28 September 2009 by <a class="url fn" href="http://aravindavk.in">Aravinda VK</a>.
  </p>
</footer><!-- /.post-info -->
<div class="sep"></div>    </div>
    <div class="entry-content">
      <p>In this article we will discuss</p>
<ol class="arabic simple">
<li>Markdown</li>
<li>Markdown PHP</li>
<li>SHJS - Syntax highlighter using JS</li>
<li>How To Use?</li>
</ol>
<div class="section" id="markdown">
<h2>Markdown</h2>
<p>Markdown is a wiki like syntax standard, to have highly readable content.</p>
<p>From Markdown website</p>
<blockquote>
Markdown is a text-to-HTML conversion tool for web writers. Markdown allows you to write using an easy-to-read, easy-to-write plain text format, then convert it to structurally valid XHTML (or HTML).</blockquote>
<p>For example</p>
<div class="highlight"><pre><span></span># Heading 1
## Heading 2

** Bold **
* Italic *

&gt; blockquote

`single line code`

Adding inline image

![Alt Text](a.jpg)

[Link](http://localhost)
</pre></div>
<p>will be converted to</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Heading 1<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Heading 2<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span> Bold <span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span> Italic <span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">blockquote</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>blockquote<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">blockquote</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>single line code<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Adding inline image<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Alt Text&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;a.jpg&quot;</span> <span class="p">/&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://localhost&quot;</span><span class="p">&gt;</span>Link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>Click <a class="reference external" href="http://daringfireball.net/projects/markdown/">here</a> for more details about markdown.</p>
</div>
<div class="section" id="markdown-php">
<h2>Markdown PHP</h2>
<p>PHP implementation of markdown is available <a class="reference external" href="http://michelf.com/projects/php-markdown/">here</a>. We can store the content in database in the markdown format itself, While displaying to user we can convert to HTML using the Markdown PHP library.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;markdown.php&#39;</span><span class="p">;</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="s1">&#39;</span>
<span class="s1"># Heading 1</span>

<span class="s1">Sample Paragraph</span>
<span class="s1">&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="nx">Markdown</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
</pre></div>
<p>Custom style sheets can be applied to required elements like h1, h2, p, blockquote, pre, code etc. This will separate content from html elements and styles, hence content will be highly readable.</p>
<p>User can use any editors which highlights the markdown syntax(I use Emacs) or any plain text editor.</p>
</div>
<div class="section" id="shjs-syntax-highlighter-using-js">
<h2>SHJS - Syntax highlighter using JS</h2>
<p>It will be good if we able to highlight the code inside pre element, I found a Javascript utility SHJS(Syntax Highlighter with JavaScript), which has very good features and multiple themes support. Read the documentation about SHJS <a class="reference external" href="http://shjs.sourceforge.net/">here</a>.</p>
<p>SHJS library requires class to be defined in pre tag like <code>&lt;pre class=&quot;sh_php&quot;&gt;</code> for PHP code, but it is not possible to add class in markdown syntax, so we will write an PHP function to add the class to each pre element. We need to add <code>#!sh_php</code> (php is used as example, that will change depending on the language) in the markdown text whereever highlighting is required.</p>
<div class="highlight"><pre><span></span><span class="x">#!sh_php</span>
<span class="cp">&lt;?php</span>
<span class="c1"># This is an example text file to show how to add language</span>
<span class="c1"># header for syntax highlight</span>
<span class="k">echo</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
</pre></div>
<p>PHP function to replace <code>#!sh_php</code> to <code>&lt;pre class=&quot;sh_php&quot;&gt;</code> is</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">addClassToPre</span><span class="p">(</span><span class="nv">$text</span><span class="p">){</span>
    <span class="c1">// Add respective class to pre tag</span>
    <span class="nv">$op</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/&lt;pre&gt;&lt;code&gt;#!([^\\n]+)/&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;&lt;pre class=\&#39;$1\&#39;&gt;&lt;code&gt;&#39;</span><span class="p">,</span>
                       <span class="nv">$text</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$op</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>If we load all the syntax highlight JavaScript files then it affects loading time, so we will add only required JavaScript files for syntax highlight based on the languages used in the content.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">addRespectiveJsFiles</span><span class="p">(</span><span class="nv">$text</span><span class="p">){</span>
    <span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/&lt;pre&gt;&lt;code&gt;#!([^\\n]+)/&#39;</span><span class="p">,</span><span class="nx">Markdown</span><span class="p">(</span><span class="nv">$text</span><span class="p">),</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="nv">$jsFiles</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$jsFiles</span> <span class="k">as</span> <span class="nv">$jsFile</span><span class="p">){</span>
        <span class="nv">$fileName</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;&lt;pre&gt;&lt;code&gt;#!&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$jsFile</span><span class="p">)</span><span class="o">.</span> <span class="s1">&#39;.js&#39;</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">&#39;lang/&#39;</span><span class="o">.</span><span class="nv">$fileName</span><span class="p">)){</span>
            <span class="k">echo</span> <span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; src=&quot;lang/&#39;</span><span class="o">.</span><span class="nv">$fileName</span> <span class="o">.</span><span class="s1">&#39;&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="how-to-use">
<h2>How To Use?</h2>
<div class="highlight"><pre><span></span><span class="x">&lt;script type=&quot;text/javascript&quot; src=&quot;sh_main.js&quot;&gt;&lt;/script&gt;</span>
<span class="x">&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</span>
<span class="x">&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;css/sh_emacs.css&quot;&gt;</span>

<span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;markdown.php&#39;</span><span class="p">;</span>

<span class="c1"># Get File content which has text in markdown format</span>
<span class="nv">$rawContent</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;sample.txt&quot;</span><span class="p">);</span>

<span class="c1"># Add the respective language files</span>
<span class="nx">addRespectiveJsFiles</span><span class="p">(</span><span class="nv">$rawContent</span><span class="p">);</span>

<span class="k">echo</span> <span class="nx">codeHighlight</span><span class="p">(</span><span class="nx">markdown</span><span class="p">(</span><span class="nv">$rawContent</span><span class="p">));</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;script&gt;</span>
<span class="x">window.onload = function(){</span>
<span class="x">sh_highlightDocument();</span>
<span class="x">};</span>
<span class="x">&lt;/script&gt;</span>
</pre></div>
<p>Btw, I use SHJS emacs theme for syntax highlight in my website :)</p>
</div>

    </div><!-- /.entry-content -->
    <div class="pure-hidden-desktop">
<footer class="post-info">
  <p class="author-and-date-info">
    Posted on Mon 28 September 2009 by <a class="url fn" href="http://aravindavk.in">Aravinda VK</a>.
  </p>
</footer><!-- /.post-info -->
<div class="sep"></div>    </div>
    <div class="permalink-div">
      Permalink: <a href="http://aravindavk.in/blog/using-markdown-and-shjs-with-php/" rel="bookmark" title="Permalink to Using Markdown and SHJS with PHP">http://aravindavk.in/blog/using-markdown-and-shjs-with-php/</a>
    </div>
<div class="comments">
  <h2>Comments !</h2>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_identifier = "blog/using-markdown-and-shjs-with-php/";
    var disqus_url = "http://aravindavk.in/blog/using-markdown-and-shjs-with-php/";
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://vkaravinda.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
</div>
  </article>
</section>
            <div class="copyright pure-hidden-desktop pure-hidden-tablet">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
          </div>
        </div>
        <div class="pure-u-1-5 pure-hidden-phone">
          <div class="right">
            <img class="me" src="/theme/img/me.jpg"/>
            <div class="sep"></div>
            <div class="pure-menu pure-menu-open">
              <a class="pure-menu-heading logo" href="/"><img src="/theme/img/logo.png" alt="aravindavk"/></a>
              <div class="social-icons">
                <a href="http://aravindavk.in/feeds/all.atom.xml" target="_blank" title="News">
                  <img src="/theme/img/feed.png" class="link-icon" alt="News"/>
                </a>
                <a href="http://twitter.com/aravindavk" target="_blank" title="Twitter">
                  <img src="/theme/img/twitter.png" class="link-icon" alt="Twitter"/>
                </a>
                <a href="https://plus.google.com/+aravindavk" target="_blank" title="Google Plus">
                  <img src="/theme/img/gplus.png" class="link-icon" alt="Google Plus"/>
                </a>
                <a href="https://github.com/aravindavk" target="_blank" title="Github">
                  <img src="/theme/img/github.png" class="link-icon" alt="Github"/>
                </a>
                <a href="http://www.flickr.com/photos/aravindavk" target="_blank" title="Flickr">
                  <img src="/theme/img/flickr.png" class="link-icon" alt="Flickr"/>
                </a>
                <a href="http://in.linkedin.com/in/aravindavk" target="_blank" title="LinkedIn">
                  <img src="/theme/img/linkedin.png" class="link-icon" alt="LinkedIn"/>
                </a>
              </div>
              <ul>
                <li class=""><a href="/">Home</a></li>
                <li class=""><a href="/me">About</a></li>
                <li class=""><a href="/projects">Projects</a></li>
                <li class=""><a href="/blogs">Blogs</a></li>
                <li class=""><a href="/talks">Talks & Articles</a></li>
              </ul>
            </div>
            <div class="sep"></div>
            <div class="copyright">&copy; 2008-2014 Aravinda VK, <br/>All rights reserved</div>
          </div>
        </div>
      </div>

    </div>
    <script src="/theme/js/ui.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11830111-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>